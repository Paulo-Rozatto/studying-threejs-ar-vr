<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diseases VR</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>

    <!-- Library of Virtual Reality -->
    <script type="text/javascript" charset="UTF-8" src="../../libs/aframe-master.js"></script>
    <script type="text/javascript" charset="UTF-8" src="../../libs/vr-interface.js"></script>
    <script type="text/javascript" charset="UTF-8" src="../../libs/vr-grid.js"></script>

    <script>
        AFRAME.registerComponent('panel', {
            init: function () {
                const self = this;
                const vrInterface = this.el.components['vr-interface'];
                const models = this.el.querySelectorAll('.panelModel');
                const clipboard = document.querySelector('#clipboard');

                this.rotation = 0;

                vrInterface.addButton('rotate', '#rotateImage', rotate)
                vrInterface.addButton('block', null, () => addToClipboard('#blockModel'));
                vrInterface.addButton('t-block', null, () => addToClipboard('#tblockModel'));
                vrInterface.addButton('led', null, () => addToClipboard('#ledModel'));
                vrInterface.addButton('battery', null, () => addToClipboard('#batteryModel'));

                function rotate() {
                    for (let i = 0; i < models.length; i++) {
                        models[i].object3D.rotation.x += (Math.PI * 0.5);
                    }
                    self.rotation -= 90;
                }

                function addToClipboard(model) {
                    clipboard.setAttribute('gltf-model', model);
                    clipboard.setAttribute('rotation', { x: 0, y: self.rotation, z: 0 });
                }
            }
        });

        AFRAME.registerComponent('grid', {
            init: function () {
                const vrGrid = this.el.components['vr-interface'];
                const clipboard = document.querySelector('#clipboard');

                const bar1 = document.querySelector('#bar1');
                const bar2 = document.querySelector('#bar2');
                const ledBar = document.querySelector('#ledBar');

                let f1 = function () {
                    bar1.object3D.visible = !bar1.object3D.visible;
                    ledBar.object3D.children[0].visible = bar1.object3D.visible && bar2.object3D.visible;
                }
                let f2 = function () {
                    bar2.object3D.visible = !bar2.object3D.visible;
                    ledBar.object3D.children[0].visible = bar1.object3D.visible && bar2.object3D.visible;
                }

                let lb = function () {
                    ledBar.object3D.visible = !ledBar.object3D.visible;
                    ledBar.object3D.children[0].visible = bar1.object3D.visible && bar2.object3D.visible;
                }

                function placeBlock(button) {
                    if (clipboard.object3D.children[0]) {
                        clipboard.object3D.children[0].rotation.y = clipboard.object3D.rotation.y;
                        button.getWorldPosition(clipboard.object3D.children[0].position);
                        this.el.sceneEl.object3D.add(clipboard.object3D.children[0]);

                        clipboard.object3D.remove(clipboard.object3D.children[0]);
                        clipboard.removeAttribute('gltf-model');
                    }
                }

                for (let i = 0; i < 45; i++) {
                    vrGrid.addButton(i.toString(), '#transparent', placeBlock);
                }
            }
        });
    </script>
</head>

<body>
    <a-scene main_scene id="scene" renderer="colorManagement: true;" background="color: #343434">
        <a-assets timeout="3000">
            <a-asset-item id="tableModel" src="../../assets/models/table.glb"></a-asset-item>
            <a-asset-item id="blockModel" src="../../assets/models/circuits/block.glb"></a-asset-item>
            <a-asset-item id="tblockModel" src="../../assets/models/circuits/l-block.glb"></a-asset-item>
            <a-asset-item id="batteryModel" src="../../assets/models/circuits/battery-block.glb"></a-asset-item>
            <a-asset-item id="ledModel" src="../../assets/models/circuits/led-block.glb"></a-asset-item>

            <img id="rotateImage" src="img/rotate.png">
            <img id="transparent" src="img/transparent.png">
        </a-assets>

        <a-entity light="type: ambient; color: #fff; intensity: 0.3"></a-entity>
        <a-entity light="color: #fff" position="-15 110 30"></a-entity>

        <a-entity id="table" gltf-model="#tableModel" position="0 -0.03 -0.75" scale="1 1 1.05"></a-entity>

        <a-entity id="led" gltf-model="#ledModel" position="0 0.97 -0.54">
            <a-light position="0 0.05 0" type="point" color="#ff9999" distance="0.15" intensity="10">
            </a-light>
        </a-entity>
        <a-entity id="b1" gltf-model="#blockModel" position="-0.2 0.97 -0.54"></a-entity>
        <a-entity id="b2" gltf-model="#blockModel" position="0.2 0.97 -0.74" rotation="0 90 0"></a-entity>
        <a-entity id="b3" gltf-model="#blockModel" position="0 0.97 -0.94" rotation="0 180 0"></a-entity>
        <a-entity id="b4" gltf-model="#blockModel" position="-0.2 0.97 -0.94" rotation="0 180 0"></a-entity>

        <a-entity id="t1" gltf-model="#tblockModel" position="-0.4 0.97 -0.54" rotation="0 -90 0"></a-entity>
        <a-entity id="t2" gltf-model="#tblockModel" position="0.2 0.97 -0.54"></a-entity>
        <a-entity id="t3" gltf-model="#tblockModel" position="0.2 0.97 -0.94" rotation="0 90 0"></a-entity>
        <a-entity id="t4" gltf-model="#tblockModel" position="-0.4 0.97 -0.94" rotation="0 180 0"></a-entity>

        <a-entity id="battery" gltf-model="#batteryModel" position="-0.4 0.97 -0.74"></a-entity>

        <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" color="#A1ACB3"></a-plane>

        <a-plane position="0 1.5 -1.51" width="2.1" height="1" color="#4D3100"></a-plane>
        <a-entity
            vr-interface="dimension: 1 5; orbits: 1.5; theta: 0; rho: 0; buttonSize: 0.4 0.4; gap: 0 0; border: 1 #6d7584; movementBar: false; transparency: true;"
            panel>
            <a-entity class="panelModel" gltf-model="#blockModel" position="-0.4 0 -1.45" rotation="90 90 90">
            </a-entity>
            <a-entity class="panelModel" gltf-model="#tblockModel" position="0 0 -1.45" rotation="90 90 90"></a-entity>
            <a-entity class="panelModel" gltf-model="#ledModel" position="0.4 0 -1.45" rotation="90 90 90"></a-entity>
            <a-entity class="panelModel" gltf-model="#batteryModel" position="0.8 0 -1.45" rotation="90 90 90">
            </a-entity>
        </a-entity>

        <a-entity
            vr-interface="dimension: 5 9; worldPosition: 0 0.97 -1.14; theta: 0; rho: -90; transparency: true; buttonSize: 0.2 0.2; border: 5 #6d7584; cursorPosition: 0 0 -0.65"
            grid>
        </a-entity>

        <a-entity id="clipboard" visible="false"></a-entity>

        <a-entity id="rig" position="0 0.1 0">
            <a-entity id="camera" camera position="0 1.6 0" look-controls="pointerLockEnabled: true"
                wasd-controls="acceleration:150; fly: true; enabled: true"></a-entity>
        </a-entity>
    </a-scene>

</body>

</html>