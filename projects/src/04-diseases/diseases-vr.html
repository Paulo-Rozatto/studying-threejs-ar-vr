<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diseases VR</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>

    <!-- Library of Virtual Reality -->
    <script type="text/javascript" charset="UTF-8" src="../../libs/aframe-master.js"></script>

    <script>
        AFRAME.registerComponent('cursor-listener', {
            init: function () {
                var lastIndex = -1;
                var COLORS = ['red', 'green', 'blue', 'purple'];
                this.el.addEventListener('click', function (evt) {
                    lastIndex = (lastIndex + 1) % COLORS.length;
                    this.setAttribute('material', 'color', COLORS[lastIndex]);
                    console.log('I was clicked at: ', evt.detail.intersection.point);
                });
            }
        });

        AFRAME.registerComponent('menu', {
            init: function () {
                const self = this;
                this.model = document.querySelector('#aneurism').object3D;
                this.camera = document.querySelector('#camera').object3D;

                this.cursor = document.querySelector('#cursor');
                this.raycaster = document.querySelector('[raycaster]');

                let panelGeometry = new THREE.PlaneGeometry(0.1, 0.05)
                // let panelMaterial = new THREE.MeshBasicMaterial({ color: new THREE.Color(0xff0000) })
                this.rotLeft = new THREE.Mesh(
                    panelGeometry,
                    new THREE.MeshBasicMaterial({
                        color: new THREE.Color(0xff0000),
                    })
                );
                this.rotLeft.position.set(-0.2, 1.5, 2.8);
                this.rotLeft.name = 'rotLeft';

                this.rotRight = new THREE.Mesh(
                    panelGeometry,
                    new THREE.MeshBasicMaterial({
                        color: new THREE.Color(0x0000FF),
                    })
                );
                this.rotRight.position.set(-0.1, 1.5, 2.8);
                this.rotRight.name = 'rotRight';

                this.zoomIn = new THREE.Mesh(
                    panelGeometry,
                    new THREE.MeshBasicMaterial({
                        color: new THREE.Color(0x00FF00),
                    })
                );
                this.zoomIn.position.set(0, 1.5, 2.8);
                this.zoomIn.name = 'zoomIn';

                this.zoomOut = new THREE.Mesh(
                    panelGeometry,
                    new THREE.MeshBasicMaterial({
                        color: new THREE.Color(0xF0FFF0),
                    })
                );
                this.zoomOut.position.set(0.1, 1.5, 2.8);
                this.zoomOut.name = 'zoomOut';

                this.el.setObject3D('rotLeft', this.rotLeft);
                this.el.setObject3D('rotRight', this.rotRight);
                this.el.setObject3D('zoomIn', this.zoomIn);
                this.el.setObject3D('zoomOut', this.zoomOut);

                this.el.classList.add('clickable');

                console.log(this.el.object3D);

                this.el.addEventListener('click', (evt) => self.clickHandle(evt));
            },
            clickHandle: function (evt) {
                // console.log('I was clicked at: ', evt.detail.intersection.object);
                let obj = evt.detail.intersection.object.name;

                switch (obj) {
                    case 'rotLeft':
                        this.model.rotation.y -= 1.2;
                        break;
                    case 'rotRight':
                        this.model.rotation.y += 1.2;
                        break;
                    case 'zoomIn':
                        this.model.position.z += 1;
                        break;
                    case 'zoomOut':
                        this.model.position.z -= 1;
                        break;
                }

            }
        });
    </script>
</head>

<body>
    <a-scene main_scene id="scene">
        <a-assets timeout="3000">
            <a-asset-item id="strokeModel" src="../../assets/models/diseases/an.glb"></a-asset-item>
            <!-- <img id="text" src="assets/textures/text.png"> -->
        </a-assets>

        <a-entity light="type: ambient; color: #fff; intensity: 0.3"></a-entity>
        <a-entity light="color: #fff" position="-65 110 0"></a-entity>

        <a-sky color="#343434"></a-sky>

        <a-entity id="aneurism" position="-1 0 0" gltf-model="#strokeModel"></a-entity>

        <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" color="#A1ACB3"
            material="transparent: true; opacity: 0.5"></a-plane>

        <!-- <a-plane id="panel" class="clickable" cursor-listener position="-0.5 1.5 3" rotation="0 90 0" width="0.1"
            height="0.05" material="">
        </a-plane>
        <a-plane id="panel" class="clickable" cursor-listener position="-0.5 1.5 2.9" rotation="0 90 0" width="0.1"
            height="0.05" material="">
        </a-plane>
        <a-plane id="panel" class="clickable" cursor-listener position="-0.5 1.5 2.8" rotation="0 90 0" width="0.1"
            height="0.05" material="">
        </a-plane>
        <a-plane id="panel" class="clickable" cursor-listener position="-1 1.5 2.7" rotation="0 90 0" width="0.1"
            height="0.05" material="">
        </a-plane> -->
        <a-entity menu></a-entity>
        <a-entity id="rig" position="0 0 3">
            <a-entity id="camera" camera position="0 1.6 0" look-controls="pointerLockEnabled: true">
                <a-entity id="cursor" cursor="fuse: true; fuseTimeout: 500" raycaster="objects: .clickable"
                    position="0 0 -0.1" geometry="primitive: ring; radiusInner: 0.004; radiusOuter: 0.006"
                    material="color: black; shader: flat">
                </a-entity>
            </a-entity>
        </a-entity>

    </a-scene>

</body>

</html>